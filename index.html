<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Agora - AI Philosopher Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <!-- Modern Fonts: Inter for UI, Playfair Display for accents -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;0,700;1,400&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg-color: #f8fafc;
      /* Slate 50 */
      --chat-bg: #ffffff;
      --accent-color: #0f172a;
      /* Slate 900 */
      --primary-color: #2563eb;
      /* Blue 600 */
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: #334155;
      /* Slate 700 */
      -webkit-font-smoothing: antialiased;
    }

    h1,
    h2,
    .serif-font {
      font-family: 'Playfair Display', serif;
    }

    /* Custom Scrollbar */
    .chat-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .chat-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-scroll::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 20px;
    }

    .chat-scroll::-webkit-scrollbar-thumb:hover {
      background-color: #94a3b8;
    }

    /* Animations */
    .typing-dot {
      animation: typing 1.4s infinite ease-in-out both;
    }

    .typing-dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .typing-dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes typing {

      0%,
      80%,
      100% {
        transform: scale(0);
        opacity: 0.5;
      }

      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .fade-in {
      animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      opacity: 0;
      transform: translateY(10px) scale(0.98);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Glassmorphism Utilities */
    .glass {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(226, 232, 240, 0.8);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }

    /* Chat Bubble Styles */
    .bubble-user {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      border-radius: 18px 18px 4px 18px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    .bubble-ai {
      background: white;
      color: #1e293b;
      border-radius: 4px 18px 18px 18px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    /* Input Glow */
    .input-glow:focus-within {
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1), 0 4px 12px rgba(0, 0, 0, 0.05);
      border-color: #3b82f6;
    }
  </style>
</head>

<body class="h-screen flex flex-col overflow-hidden bg-slate-50 relative">

  <!-- Background Decorative Elements -->
  <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
    <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-100 rounded-full blur-3xl opacity-40"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-indigo-100 rounded-full blur-3xl opacity-40">
    </div>
  </div>

  <!-- Header -->
  <header class="glass sticky top-0 z-20 px-6 py-4 flex justify-between items-center transition-all duration-300">
    <div class="flex items-center gap-3 group cursor-pointer">
      <div
        class="w-10 h-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg group-hover:scale-105 transition-transform duration-300">
        <i class="fas fa-columns text-lg"></i>
      </div>
      <div>
        <h1 class="text-xl font-bold tracking-tight text-slate-900 leading-tight">The Agora</h1>
        <p class="text-[11px] font-medium text-slate-500 uppercase tracking-widest">Philosophy AI</p>
      </div>
    </div>
    <button onclick="toggleSettings()"
      class="w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-500 hover:text-slate-800 transition duration-200">
      <i class="fas fa-cog text-lg"></i>
    </button>
  </header>

  <!-- Settings Modal -->
  <div id="settings-modal"
    class="hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300">
    <div
      class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-100 transform transition-all scale-100">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-slate-800 serif-font">Settings</h2>
        <button onclick="toggleSettings()" class="text-slate-400 hover:text-slate-600 transition"><i
            class="fas fa-times text-xl"></i></button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-slate-700 mb-2">OpenAI API Key</label>
          <div class="relative">
            <input type="password" id="api-key-input" placeholder="sk-..."
              class="w-full p-3 pl-10 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition font-mono text-sm">
            <i class="fas fa-key absolute left-3.5 top-3.5 text-slate-400 text-sm"></i>
          </div>
          <p class="text-xs text-slate-500 mt-2 leading-relaxed">
            Leave empty to use <strong>Mock Mode</strong> (demo mode with pre-set responses).
          </p>
        </div>
      </div>

      <div class="flex justify-end gap-3 mt-8">
        <button onclick="toggleSettings()"
          class="px-5 py-2.5 text-slate-600 hover:bg-slate-50 rounded-lg text-sm font-medium transition">Cancel</button>
        <button onclick="saveSettings()"
          class="px-5 py-2.5 bg-slate-900 text-white rounded-lg hover:bg-slate-800 transition shadow-lg text-sm font-medium">Save
          Changes</button>
      </div>
    </div>
  </div>

  <!-- Main Chat Area -->
  <main class="flex-1 overflow-hidden relative flex flex-col max-w-5xl mx-auto w-full">

    <!-- Messages List -->
    <div id="chat-container" class="flex-1 overflow-y-auto px-4 py-8 md:px-8 space-y-8 chat-scroll scroll-smooth">
      <!-- Welcome Message -->
      <div class="flex gap-4 fade-in max-w-2xl mx-auto">
        <div
          class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center text-white flex-shrink-0 shadow-lg border-2 border-white ring-1 ring-slate-100">
          <i class="fas fa-robot text-sm"></i>
        </div>
        <div class="bubble-ai p-6">
          <p class="text-slate-700 leading-7 text-[15px]">
            <span class="font-bold text-slate-900 block mb-2 text-sm uppercase tracking-wide">Moderator</span>
            Welcome to <strong>The Agora</strong>.<br>
            Share your thoughts, and I will summon <strong>Socrates</strong>, <strong>Aristotle</strong>, and
            <strong>Schopenhauer</strong> to debate your dilemma.
          </p>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="p-4 md:p-6 bg-gradient-to-t from-white via-white to-transparent z-10">
      <div
        class="max-w-3xl mx-auto relative input-glow bg-white rounded-2xl border border-slate-200 transition-all duration-300">
        <textarea id="user-input" rows="1" placeholder="What is on your mind?"
          class="w-full p-4 pr-14 bg-transparent rounded-2xl focus:outline-none resize-none font-sans text-slate-700 placeholder-slate-400 max-h-32"
          style="min-height: 60px;" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
          onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>

        <button onclick="sendMessage()"
          class="absolute right-2 bottom-2 w-10 h-10 bg-slate-900 text-white rounded-xl flex items-center justify-center hover:bg-slate-800 hover:scale-105 active:scale-95 transition-all duration-200 shadow-md">
          <i class="fas fa-arrow-up text-sm"></i>
        </button>
      </div>
      <p class="text-center text-[10px] text-slate-400 mt-3">Press Enter to send • Shift + Enter for new line</p>
    </div>
  </main>

  <script>
    // Philosophers Configuration
    const philosophers = [
      {
        id: 'socrates',
        name: 'Socrates',
        title: 'The Gadfly',
        avatar: 'images/socrates.jpg',
        color: 'border-blue-200 bg-blue-50/50',
        text: 'text-blue-900',
        prompt: 'You are Socrates. Engage in the Socratic method. Question everything. Be humble yet probing.'
      },
      {
        id: 'aristotle',
        name: 'Aristotle',
        title: 'The Realist',
        avatar: 'images/aristotle.jpg',
        color: 'border-emerald-200 bg-emerald-50/50',
        text: 'text-emerald-900',
        prompt: 'You are Aristotle. Focus on logic, virtue, and practical wisdom (Phronesis).'
      },
      {
        id: 'schopenhauer',
        name: 'Schopenhauer',
        title: 'The Pessimist',
        avatar: 'images/schopenhauer.jpg',
        color: 'border-slate-200 bg-slate-100/50',
        text: 'text-slate-900',
        prompt: 'You are Schopenhauer. Focus on the suffering of existence and the Will.'
      }
    ];

    let apiKey = localStorage.getItem('openai_api_key') || '';
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');

    function toggleSettings() {
      const modal = document.getElementById('settings-modal');
      modal.classList.toggle('hidden');
      if (!modal.classList.contains('hidden')) {
        document.getElementById('api-key-input').value = apiKey;
        document.getElementById('api-key-input').focus();
      }
    }

    function saveSettings() {
      const input = document.getElementById('api-key-input');
      apiKey = input.value.trim();
      localStorage.setItem('openai_api_key', apiKey);
      toggleSettings();
      // Show small toast notification instead of alert could be better, but alert is fine for now
    }

    function scrollToBottom() {
      chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
    }

    function appendMessage(role, text, philosopherId = null) {
      const div = document.createElement('div');
      div.className = `flex gap-4 fade-in max-w-2xl mx-auto ${role === 'user' ? 'justify-end' : ''}`;

      let contentHtml = '';

      if (role === 'user') {
        contentHtml = `
          <div class="bubble-user px-6 py-4 max-w-[85%] text-[15px] leading-relaxed shadow-lg">
            <div class="whitespace-pre-wrap">${text}</div>
          </div>
          <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 flex-shrink-0 self-end mb-1">
            <i class="fas fa-user text-xs"></i>
          </div>`;
      } else {
        const philosopher = philosophers.find(p => p.id === philosopherId);
        contentHtml = `
          <div class="flex flex-col items-center gap-2 flex-shrink-0 self-start mt-1">
            <div class="relative group">
               <img src="${philosopher.avatar}" class="w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm object-cover group-hover:scale-110 transition-transform duration-200" alt="${philosopher.name}">
               <div class="absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-sm border border-slate-100">
                  <i class="fas fa-quote-left text-[8px] text-slate-400 block w-3 h-3 text-center leading-3"></i>
               </div>
            </div>
          </div>
          <div class="bubble-ai p-6 max-w-[85%] relative group hover:shadow-md transition-shadow duration-300">
             <div class="flex items-baseline justify-between mb-2 pb-2 border-b border-slate-100">
                <span class="font-bold text-slate-900 text-sm serif-font tracking-wide">${philosopher.name}</span>
                <span class="text-[10px] text-slate-400 uppercase tracking-wider font-medium">${philosopher.title}</span>
             </div>
             <div class="leading-relaxed text-[15px] text-slate-700 whitespace-pre-wrap">${text}</div>
          </div>
        `;
      }

      div.innerHTML = contentHtml;
      chatContainer.appendChild(div);
      scrollToBottom();
      return div;
    }

    function appendLoading(philosopherId) {
      const philosopher = philosophers.find(p => p.id === philosopherId);
      const div = document.createElement('div');
      div.id = `loading-${philosopherId}`;
      div.className = 'flex gap-4 fade-in max-w-2xl mx-auto';
      div.innerHTML = `
        <div class="flex flex-col items-center gap-2 flex-shrink-0 self-start mt-1">
           <img src="${philosopher.avatar}" class="w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm opacity-60 grayscale">
        </div>
        <div class="bubble-ai px-5 py-4 flex items-center gap-1.5 h-12">
          <div class="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
          <div class="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
          <div class="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
        </div>
      `;
      chatContainer.appendChild(div);
      scrollToBottom();
      return div;
    }

    // --- Mock Logic Same as Before ---
    function generateMockResponse(userText, philosopherId) {
      const lowerText = userText.toLowerCase();

      const topics = {
        love: ['love', 'relationship', 'heart', 'marriage', 'dating', 'lonely', 'breakup', 'wife', 'husband'],
        work: ['work', 'job', 'career', 'boss', 'money', 'salary', 'busy', 'tired', 'success', 'fail'],
        meaning: ['meaning', 'life', 'death', 'die', 'purpose', 'exist', 'god', 'why', 'empty'],
        happiness: ['happy', 'sad', 'joy', 'depression', 'anxiety', 'feel', 'emotion', 'cry']
      };

      let detectedTopic = 'generic';
      for (const [topic, keywords] of Object.entries(topics)) {
        if (keywords.some(k => lowerText.includes(k))) {
          detectedTopic = topic;
          break;
        }
      }

      const responses = {
        socrates: {
          love: [
            "You speak of love, but have you defined what love truly is? Is it a desire for what we lack, or a celebration of what we have?",
            "If you seek love, is it for the beauty of the body, or the beauty of the soul? Which do you think is more enduring?",
            "Does love make you whole, or does it merely expose your own incompleteness? Let us examine this feeling."
          ],
          work: [
            "Why do you labor? Is it for the sake of the wealth it brings, or for the good of the work itself?",
            "If a man works all his life but never knows himself, is he truly rich? What is the currency of the soul?",
            "You say you are busy. But are you busy with things that matter, or merely busy with being busy?"
          ],
          meaning: [
            "An unexamined life is not worth living. You ask for meaning, but meaning is not found, it is created through questioning.",
            "Why do you fear death? Is it not simply the absence of sensation? Or do you fear leaving a life you haven't yet truly lived?",
            "To know that you know nothing is the beginning of wisdom. Perhaps the meaning is in the search itself."
          ],
          happiness: [
            "Can a man be happy if he is not virtuous? Can pleasure truly satisfy the soul, or is it merely a fleeting shadow?",
            "You seek happiness as if it were a destination. But is it not a byproduct of living a just and examined life?",
            "Why are you sad? Is it because reality does not match your expectations? Then which should change: reality or your mind?"
          ],
          generic: [
            "Interesting. But tell me, what is the underlying principle behind this thought?",
            "You seem certain. But how can you be sure that what you see is the truth and not just a shadow on the wall?",
            "Let us dissect this further. If we strip away the emotions, what remains of your statement?"
          ]
        },
        aristotle: {
          love: [
            "Love, in its highest form, is a friendship of virtue. We wish the good for the other for their own sake, not for utility or pleasure.",
            "We must find the mean in relationships. Neither be too distant nor too clinging. Virtue lies in the balance.",
            "Man is a social animal. To love and be loved is part of our function (ergon). But it must be guided by reason."
          ],
          work: [
            "Work is a means to an end, which is leisure and the cultivation of the mind. Do not mistake the means for the end.",
            "Excellence is not an act, but a habit. We are what we repeatedly do. Your work should reflect your virtue.",
            "In economics and career, we must avoid the extremes of greed and sloth. Prudence (Phronesis) is your best guide."
          ],
          meaning: [
            "The goal of life is Eudaimonia — flourishing. It is the activity of the soul in accordance with virtue.",
            "Everything in nature has a purpose. The acorn becomes the oak. What is the potential within you waiting to be actualized?",
            "We find meaning by fulfilling our function as rational beings. To think and to act virtuously is our highest calling."
          ],
          happiness: [
            "Happiness depends upon ourselves. It is not a state of fleeting pleasure, but a lifetime of virtuous action.",
            "Do not confuse pleasure with happiness. Cattle can feel pleasure; only humans can achieve Eudaimonia.",
            "If you are suffering, examine your habits. Are you acting in accordance with reason and virtue?"
          ],
          generic: [
            "Let us analyze this logically. What is the cause of this situation? There are four causes to consider...",
            "We must define our terms clearly. Logic is the tool we use to separate truth from error.",
            "Practical wisdom tells us to look at the specific circumstances. One rule does not fit all situations."
          ]
        },
        schopenhauer: {
          love: [
            "Love is merely the trap of the species to ensure reproduction. It is a powerful illusion that blinds us to reason.",
            "You seek union with another to escape your own solitude, but in the end, we are all alone in our suffering.",
            "The more you love, the more you open yourself to pain. Yet, we cannot help but desire. This is the tyranny of the Will."
          ],
          work: [
            "We work to sustain a life that is mostly misery. It is like blowing up a soap bubble as large as possible, knowing it will burst.",
            "Ambition is foolish. You strive for status and wealth, only to find that possession kills the desire and leaves you bored.",
            "Life is a business that does not cover its costs. Your labor is the penalty of existence."
          ],
          meaning: [
            "Life has no intrinsic meaning. It is a blind, striving Will. The only escape is through art or ascetic denial of the self.",
            "We are like hedgehogs in the cold — huddling together for warmth but pricking each other with our spines.",
            "To be born is to suffer. The question is not 'why me?', but rather realizing that suffering is the essence of life."
          ],
          happiness: [
            "Happiness is a negative state — it is merely the absence of pain. Do not seek joy; seek only to avoid misery.",
            "The two enemies of human happiness are pain and boredom. When we escape one, we fall into the other.",
            "Optimism is a bitter mockery of the untold suffering of humanity. Lower your expectations, and you will find peace."
          ],
          generic: [
            "This too is a manifestation of the Will to Live. A blind, ceaseless striving that leads nowhere.",
            "Look at the world — it is a penal colony. Your complaint is just one voice in a chorus of universal suffering.",
            "The world is my representation. Your problem exists only because your mind perceives it so."
          ]
        }
      };

      const pool = responses[philosopherId][detectedTopic] || responses[philosopherId]['generic'];
      return pool[Math.floor(Math.random() * pool.length)];
    }

    async function callOpenAI(messages, philosopher) {
      if (!apiKey) {
        return new Promise(resolve => {
          setTimeout(() => {
            const lastMsg = messages[messages.length - 1].content;
            const response = generateMockResponse(lastMsg, philosopher.id);
            resolve(response);
          }, 1500 + Math.random() * 2000);
        });
      }

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [
              { role: "system", content: philosopher.prompt },
              ...messages
            ],
            temperature: 0.7
          })
        });

        const data = await response.json();
        if (data.error) throw new Error(data.error.message);
        return data.choices[0].message.content;

      } catch (error) {
        console.error(error);
        return `(Connection Error: ${error.message})`;
      }
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      appendMessage('user', text);
      userInput.value = '';
      // Reset height
      userInput.style.height = 'auto';

      const contextMessages = [{ role: "user", content: text }];
      const selectedPhilosophers = philosophers;

      for (const p of selectedPhilosophers) {
        const loadingDiv = appendLoading(p.id);
        const response = await callOpenAI(contextMessages, p);
        loadingDiv.remove();
        appendMessage('assistant', response, p.id);
        await new Promise(r => setTimeout(r, 1000));
      }
    }
  </script>
</body>

</html>